# Jurisdiction Pixel Generator

This tool creates priority and feasibility pixel grids for California jurisdictions, combining geographic data with demographic and infrastructure attributes.

## Directory Structure

```
jurisdiction_script/
├── jscript.py                  # Main jurisdiction pixel generator
├── create_utility_pixels.py    # Utility line pixelation script
├── config/                     # YAML configuration files
│   ├── alameda_berkeley.yaml
│   ├── alameda_oakland.yaml
│   └── ... (other configs)
├── data/
│   ├── boundaries/         # City/jurisdiction boundary files (565+ cities)
│   ├── pop/               # Population pixel grids
│   │   └── pop.json       # Main population grid
│   ├── grids/             # Infrastructure pixel grids
│   │   └── pge.json       # PG&E utility grid
│   ├── census/            # Census data
│   │   └── mfre.json      # Multi-family & renter data
│   └── other/             # Additional attributes
│       ├── ces4/          # CalEnviroScreen 4.0 data
│       ├── nevi.json      # NEVI funding eligibility
│       ├── irs30c.json    # IRS 30C tax credit eligibility
│       ├── lev.json       # EV ownership data
│       └── pgelines.json  # PG&E electrical capacity
└── out/                   # Output files
```

## Usage

```bash
python jscript.py <config_name>
```

Example:
```bash
python jscript.py alameda_berkeley
```

This reads `config/alameda_berkeley.yaml` and generates:
- `out/alameda_berkeley_priority.json` - Priority pixels with demographic attributes
- `out/alameda_berkeley_feasibility.json` - Feasibility pixels with infrastructure attributes

## How It Works

1. **Reads configuration** specifying:
   - Jurisdiction boundaries
   - Priority pixel source (usually population grid)
   - Feasibility pixel source (usually utility grid)
   - Attributes to join to each pixel type

2. **Clips pixels** to jurisdiction boundary

3. **Joins attributes** using spatial operations:
   - `binary`: 1 if pixel intersects feature, 0 otherwise
   - `binary_full`: Same but uses full geometry instead of centroid
   - `numeric`: Value from intersecting feature
   - `nearest`: Value from nearest feature
   - `popmul`: Multiplies population by attribute value
   - `max`: Maximum value from all intersecting features

4. **Saves results** as GeoJSON files

## Configuration File Format

```yaml
jurisdictions:
  - name: jurisdiction_name
    boundary: boundaries/city_boundary.geojson

priority:
  pixels: pop/pop.json
  attributes:
    - file: census/mfre.json
      columns:
        - column: "% MF"
          name: Multi-Family Housing Residents
          join: popmul

feasibility:
  pixels: grids/pge.json
  attributes:
    - file: other/nevi.json
      columns:
        - column: nevi
          name: nevi
          join: binary
```

## Creating Utility Pixel Grids

When utility line data is updated, you'll need to regenerate the utility pixel grid:

```bash
python create_utility_pixels.py -i data/other/utility_lines.geojson -o data/grids/utilities_pixels.json
```

**What this does:**
1. Creates a 100m x 100m grid covering all of California (~98 million grid squares)
2. Buffers utility lines by 75 meters
3. Clips the grid to areas within 75m of utility infrastructure
4. Converts centroids to 100m square polygons
5. Outputs ~2 million pixels near utility lines

**Options:**
- `-i, --input`: Input utility lines GeoJSON file (required)
- `-o, --output`: Output pixel grid GeoJSON file (required)
- `-b, --buffer`: Buffer distance in meters (default: 75)

**Note:** This process requires significant memory and time due to the large grid size.

## Data Requirements

All data files referenced in config files must exist in the `data/` directory with proper relative paths.

### Input Data Files

**Required for utility pixelation:**
- `data/other/utility_lines.geojson` - Combined utility line data from PG&E, SDG&E, LADWP, and SoCal Edison

**Generated by pixelation script:**
- `data/grids/utilities_pixels.json` - Feasibility pixel grid near utility infrastructure

**Pre-existing data:**
- `data/pop/pop.json` - Population pixel grid for priority analysis
- `data/boundaries/` - City and county boundary files
- `data/census/mfre.json` - Multi-family housing and renter data
- `data/other/ces4/` - CalEnviroScreen environmental justice data
- `data/other/nevi.json` - NEVI federal funding eligibility
- `data/other/irs30c.json` - IRS 30C tax credit eligibility
- `data/other/lev.json` - Electric vehicle ownership data
- `data/other/pgelines.json` - PG&E electrical capacity data
